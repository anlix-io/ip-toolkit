"use strict";Object.defineProperty(exports, "__esModule", {value: true});var j=Object.defineProperty;var C=(t,r)=>{for(var n in r)j(t,n,{get:r[n],enumerable:!0})};var E=(t,r,n)=>{if(!r.has(t))throw TypeError("Cannot "+n)};var m=(t,r,n)=>(E(t,r,"read from private field"),n?n.call(t):r.get(t)),R=(t,r,n)=>{if(r.has(t))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(t):r.set(t,n)},M=(t,r,n,e)=>(E(t,r,"write to private field"),e?e.call(t,n):r.set(t,n),n);var X={};C(X,{contains:()=>V,ip2long:()=>s,ipRange:()=>I,isCIDR:()=>L,isConflict:()=>B,isEqual:()=>D,isPrivate:()=>$,isSameSubnet:()=>G,isValidIP:()=>f,isValidMask:()=>u,long2ip:()=>a,parseCIDR:()=>b,parseSubnet:()=>_,toBinHex:()=>q,toIPv6Format:()=>O,toInverseMask:()=>Q,toMaskLength:()=>k,toSubnetMask:()=>h});function s(t){if(!f(t))return!1;let r=0,n=t.split(".");for(let e of n)r=(r<<8)+ +e;return r>>>0}function a(t){if(typeof t!="number"||isNaN(t))return!1;if(t>=0&&t<=4294967295){let r=[];for(let n=3;n>=0;n--)r.push(t>>>n*8&255);return r.join(".")}else return!1}var d,x,S=class S{constructor(r,n){R(this,d,void 0);R(this,x,void 0);if(+r<0||+r>4294967295||+n<0||+n>4294967295)throw new Error("Invalid start or end IPv4 address");M(this,d,r),M(this,x,n)}static fromLong(r,n){if(typeof r!="number"||typeof n!="number")throw new Error("Invalid start or end IPv4 address");if(+n<+r)throw new Error("Invalid range value, end must be greater than or equal to start");return new S(r,n)}static fromString(r,n){let e=s(r),o=s(n);if(typeof e!="number"||typeof o!="number")throw new Error("Invalid start or end IPv4 address");if(o<e)throw new Error("Invalid range value, end must be greater than or equal to start");return new S(e,o)}ip2long(){return[m(this,d),m(this,x)]}long2ip(){return[a(m(this,d)),a(m(this,x))]}ipCount(){return m(this,x)-m(this,d)+1}contains(r){let n=s(r);return typeof n!="number"?!1:n>=m(this,d)&&n<=m(this,x)}};d=new WeakMap,x=new WeakMap;var I=S;function L(t){return typeof t!="string"?!1:typeof b(t)=="object"}function D(t,r){return typeof t=="number"&&(t<0||t>4294967295)||typeof r=="number"&&(r<0||r>4294967295)||(typeof t=="string"&&(t=s(t)),typeof r=="string"&&(r=s(r)),typeof t!="number"||typeof r!="number")?!1:t===r}function V(t,r){let n=b(t);if(typeof n!="object"||!f(r))return!1;let{cidrMask:e,firstHost:o,lastHost:i,networkAddress:p,broadcastAddress:c}=n;return e>=31?I.fromString(o,i).contains(r):I.fromString(p,c).contains(r)}function f(t,r={strict:!1}){return r.strict?/^(1\d{2}|2[0-4]\d|25[0-5]|[1-9]\d|[1-9])(\.(1\d{2}|2[0-4]\d|25[0-5]|[1-9]\d|\d)){3}$/.test(t):/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/.test(t)}function $(t){if(!f(t))return!1;let r=[{start:"10.0.0.0",end:"10.255.255.255"},{start:"127.0.0.0",end:"127.255.255.255"},{start:"172.16.0.0",end:"172.31.255.255"},{start:"169.254.0.0",end:"169.254.255.255"},{start:"192.168.0.0",end:"192.168.255.255"}];for(let n of r)if(I.fromString(n.start,n.end).contains(t))return!0;return!1}function b(t){if(typeof t!="string")return!1;let[r,n]=t.split("/");if(r===void 0||n===void 0||n===""||!f(r,{strict:!0})||!u(+n))return!1;let e=32-+n,o=s(r),i=Number(0b1n<<BigInt(e)),p=+n?o>>e<<e>>>0:0,c=(p|i-1)>>>0;return{ipCount:i,cidrMask:+n,usableCount:+n<31?i-2:i,subnetMask:h(+n),networkAddress:+n<31?a(p):"",broadcastAddress:+n<31?a(c):"",firstHost:a(p+(+n<31?1:0)),lastHost:a(c-(+n<31?1:0))}}function B(t){if(!Array.isArray(t)||t.length===0)return!1;let r=[];for(let n of t){let e=b(n);typeof e=="object"&&r.push({cidr:n,networkAddress:e.networkAddress||e.firstHost})}for(let n=0;n<r.length;n++)for(let e=n+1;e<r.length;e++){let o=V(r[e].cidr,r[n].networkAddress),i=V(r[n].cidr,r[e].networkAddress);if(o||i)return!0}return!1}function _(t,r){if(!f(t)||!u(r))return!1;let n=k(r);return b(`${t}/${n}`)}function u(t){if(typeof t=="number"&&!isNaN(t))return!(t<0||t>32);if(typeof t=="string"){let r=s(t);return typeof r!="number"?!1:/^1*0*$/.test(r.toString(2).padStart(32,"0"))}else return!1}function G(t,r,n){if(!f(t)||!f(r)||!u(n))return!1;let e=s(t),o=s(r);typeof n=="number"&&(n=h(n));let i=s(n);return(e&i)===(o&i)}function q(t){if(!f(t))return!1;let r=s(t);return{decimal:r,hex:`0x${r.toString(16).padStart(8,"0")}`,binary:r.toString(2).padStart(32,"0")}}var v={};C(v,{compressedForm:()=>P,contains:()=>H,expandedForm:()=>y,ip2long:()=>l,isCIDR:()=>z,isConflict:()=>K,isEqual:()=>J,isValidIP:()=>g,long2ip:()=>F,parseCIDR:()=>A});function l(t){if(!g(t))return!1;let r=[];t=y(t);let n=t.split(":");for(let e=0;e<n.length;e++){let o=parseInt(n[e],16);r.push(o.toString(2).padStart(16,"0"))}return BigInt(`0b${r.join("")}`)}function P(t){if(!g(t))return!1;if(l(t)===0n)return"::";t=y(t);let n=t.split(":").map(o=>{let i=parseInt(o,16);return i?i.toString(16):"X"}).join(":"),e=[/(X:X:X:X:X:X:X)/,/(X:X:X:X:X:X)/,/(X:X:X:X:X)/,/(X:X:X:X)/,/(X:X:X)/,/(X:X)/];for(let o=0;o<e.length;o++)if(n.match(e[o]))return n.replace(e[o],":").replace(":::","::").replaceAll("X","0");return n.replaceAll("X","0")}function F(t){if(typeof t!="bigint")return!1;if(t>=0n&&t<=340282366920938463463374607431768211455n){let r=[],n=t.toString(16).padStart(32,"0");for(let e=0;e<8;e++)r.push(n.slice(e*4,(e+1)*4));return P(r.join(":"))}else return!1}function H(t,r){let n=A(t);if(typeof n!="object"||!g(r))return!1;let{lastHost:e,firstHost:o}=n,i=l(r),p=l(e),c=l(o);return i>=c&&i<=p}function z(t){return typeof t!="string"?!1:typeof A(t)=="object"}function J(t,r){return typeof t=="bigint"&&(t<0n||t>340282366920938463463374607431768211455n)||typeof r=="bigint"&&(r<0||r>340282366920938463463374607431768211455n)||(typeof t=="string"&&(t=l(t)),typeof r=="string"&&(r=l(r)),typeof t!="bigint"||typeof r!="bigint")?!1:t===r}function g(t){return/^[\s]*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}))|:)))(%.+)?[\s]*$/.test(t)}function K(t){if(!Array.isArray(t)||t.length===0)return!1;let r=[];for(let n of t){let e=A(n);typeof e=="object"&&r.push({cidr:n,firstHost:e.firstHost})}for(let n=0;n<r.length;n++)for(let e=n+1;e<r.length;e++){let o=H(r[e].cidr,r[n].firstHost),i=H(r[n].cidr,r[e].firstHost);if(o||i)return!0}return!1}function A(t){if(typeof t!="string")return!1;let[r,n]=t.split("/");if(r===void 0||n===void 0||n==="")return!1;let e=+n;if(!g(r)||isNaN(e)||e<0||e>128)return!1;let o=BigInt(128-e),i=l(r),p=BigInt(0b1n<<o),c=i>>o<<o,w=F(c),N=F(c|p-1n);return{ipCount:p,firstHost:w,lastHost:N,prefixLength:e}}function y(t){if(!g(t))return!1;if(t==="::")return"0000:".repeat(8).slice(0,-1);let r=t.split(":");for(let e=0;e<r.length;e++)r[e]===""&&r[e+1]===""&&r.splice(e,1);let n=r[r.length-1];if(X.isValidIP(n)){let e=X.toBinHex(n).hex.slice(2);r.pop()&&r.push(e.slice(0,4),e.slice(4))}return r.map(e=>e?e.padStart(4,"0"):"0000:".repeat(9-r.length).slice(0,-1)).join(":")}function O(t){if(!f(t))return!1;let r=s(t),n=a(r);return{mapped:`::ffff:${n}`,comperssed:P(`::ffff:${n}`),expanded:y(`::ffff:${n}`)}}function h(t){if(typeof t!="number"||isNaN(t)||!u(t))return!1;let r=4294967295<<32-t;return t?a(r>>>0):"0.0.0.0"}function k(t){if(typeof t!="string"||!u(t))return!1;let r=s(t);return r===0?0:r.toString(2).replaceAll("0","").length}function Q(t){if(!u(t))return!1;typeof t=="number"&&(t=h(t));let n=~s(t)>>>0;return a(n)}exports.IPv4 = X; exports.IPv6 = v;
